% !TEX root = ../ts_pset_main.tex


\chapter{ETS}

Почитать про ETS модели в книжке \cite{hyndman2018forecasting}.

\begin{problem}
  Рассмотрим ETS-ANN модель с $\alpha = 1/2$, $y_1=6$, $y_2=9$, $y_3 = 6$, $\sigma^2=9$.


  \begin{enumerate}
    \item Найдите величину $l_0$, которая минимизирует $RSS$;
    \item Постройте точечный прогноз $\hat y_{4|2}$, $\hat y_{5|2}$;
     \item Постройте 95\%-ый предиктивный интервал для $y_{4}$ и $y_{5}$.
  \end{enumerate}
\begin{sol}
  \[
    \hat y_{4|3} = l_3 
  \]
  \[
    y_4 - \hat y_{4|3} = l_3 + \varepsilon_4 - l_3 = \varepsilon_4  
  \]
  \[
  \Var(y_4 - \hat y_{4|3} \mid \mathcal{F}_3) = \Var(\varepsilon_4 \mid \mathcal{F}_3) = \Var(\varepsilon_4)  
  \]
  \[
  \hat y_{5|3} = l_3 
  \]
  \begin{multline}
  y_5 - \hat y_{5|3} = l_4  + \varepsilon_5 - l_3  = (l_3 + \alpha \varepsilon_4)  + 
   \varepsilon_5 - l_3 = \\
  = \varepsilon_5 + \alpha  \varepsilon_4 
  \end{multline}
  \[
  \Var(y_5 - \hat y_{5|3} \mid \mathcal{F}_3) = \Var(\varepsilon_5 + \alpha  \varepsilon_4 )  
  \]
    
\end{sol}
\end{problem}

\begin{problem}
  Рассмотрим ETS-AAN модель с $\alpha = 1/2$, $\beta=3/4$, $l_{0}=7$, $b_0=2$, $y_1=6$, $y_2=9$, $y_3=3$, $\sigma^2=9$.
  \begin{enumerate}
    \item Постройте точечный прогноз $\hat y_{4|3}$, $\hat y_{5|3}$;
    \item Постройте 95\%-ый предиктивный интервал для $y_{4}$ и $y_{5}$.
  \end{enumerate}
\begin{sol}
\[
\hat y_{4|3} = l_3 + b_3
\]
\[
y_4 - \hat y_{4|3} = l_3 + b_3 + \varepsilon_4 - (l_3 + b_3) = \varepsilon_4  
\]
\[
\Var(y_4 - \hat y_{4|3} \mid \mathcal{F}_3) = \Var(\varepsilon_4 \mid \mathcal{F}_3) = \Var(\varepsilon_4)  
\]
\[
\hat y_{5|3} = l_3 + 2b_3
\]
\begin{multline}
y_5 - \hat y_{5|3} = l_4 + b_4 + \varepsilon_5 - (l_3 + 2b_3) = (l_3 + b_3 + \alpha \varepsilon_4)  + 
(b_3 + \beta \varepsilon_4) + \varepsilon_5 - (l_3 + 2b_3) = \\
= \varepsilon_5 + (\alpha + \beta) \varepsilon_4 
\end{multline}
\[
\Var(y_5 - \hat y_{5|3} \mid \mathcal{F}_3) = \Var(\varepsilon_5 + (\alpha + \beta) \varepsilon_4 )  
\]
\end{sol}
\end{problem}

\begin{problem}
  Рассмотрим ETS-AAN модель с $\alpha = 1/2$, $\beta=3/4$, $l_{0}=7$, $y_1=6$, $y_2=9$, $\sigma^2=16$.


  \begin{enumerate}
    \item Найдите величину $b_0$, которая минимизирует $RSS$;
    \item Постройте точечный прогноз $\hat y_{3|2}$, $\hat y_{4|2}$;
     \item Постройте 95\%-ый предиктивный интервал для $y_{3}$ и $y_{4}$.
  \end{enumerate}
\begin{sol}
\end{sol}
\end{problem}

\begin{problem}
  Рассмотрим ETS-AAN модель с $\alpha = 1/2$, $\beta=3/4$, $l_{0}=7$, $y_1=6$, $y_2=9$, $y_3=3$.

  Выпишите сумму квадратов ошибок прогнозов на один шаг вперёд через $b_0$.
  % минимизация тут длинная
\begin{sol}
\end{sol}
\end{problem}



\begin{problem}
  Рассмотрим ETS-AAN модель с $\alpha = 1/2$, $\beta=3/4$, $l_{99}=8$, $b_{99}=1$, $y_{99}=10$, $y_{100}=8$, $\sigma^2=16$.
  \begin{enumerate}
    \item Найдите $l_{100}$, $b_{100}$, $l_{98}$, $b_{98}$;
    \item Постройте точечный прогноз $\hat y_{101|100}$, $\hat y_{102|100}$;
    \item Постройте 95\%-ый предиктивный интервал для $y_{101}$ и $y_{102}$.
  \end{enumerate}
\begin{sol}
\end{sol}
\end{problem}


\begin{problem}
Для каждой из ETS моделей найдите эквивалентную модель класса ARIMA:
	\begin{enumerate}
		\item Простое экспоненциальное сглаживание, ETS-ANN;
		\item Аддитивное сглаживание Хольта, ETS-AAN;
		\item Аддитивное сглаживание Хольта с угасающим трендом, ETS-AAdN;
		\item Аддитивное сглаживание Хольта-Винтерса для месячных данных, ETS-AAA;
		\item Аддитивное сглаживание Хольта-Винтерса с угасающим трендом для месячных данных, ETS-AAdA;
		\item ETS-ANA;
	\end{enumerate}
\begin{sol}
	\begin{enumerate}
		\item Простое экспоненциальное сглаживание, ETS-ANN; ARIMA(0,1,1)
		\item Аддитивное сглаживание Хольта, ETS-AAN; ARIMA(0,2,2)
		\item Аддитивное сглаживание Хольта с угасающим трендом, ETS-AAdN; ARIMA(1,1,2)
		\item Аддитивное сглаживание Хольта-Винтерса для месячных данных, ETS-AAA; ARIMA(0,1,13)-SARIMA(0,1,0)
		\item Аддитивное сглаживание Хольта-Винтерса с угасающим трендом для месячных данных, ETS-AAdA; ARIMA(0,1,13)-SARIMA(0,1,0)
		\item ETS-ANA; ARIMA(0,1,12)-SARIMA(0,1,0)
	\end{enumerate}
\end{sol}
\end{problem}


\begin{problem}
Рассмотрим ETS-AAN модель. По каким параметрам модели оптимальные точки можно получить в явном виде?
\begin{sol}
По $l_0$, $b_0$;
\end{sol}
\end{problem}

\begin{problem}
Процесс $y_t$ описывается $ETS(MNM)$ моделью. 
Верно ли, что процесс $z_t = \ln y_t$ точно описывается $ETS(ANA)$ моделью? А примерно?
\begin{sol}
  Только примерно, $\ln (1 + x) \approx x$.
\end{sol}
\end{problem}
  

\begin{problem}
Рассмотрим $ETS(AA_dN)$ модель с $\phi = 0.9$, $\alpha=0.3$, $\beta=0.1$ и $\sigma^2=16$. 
Выразите 95\% предиктивный интервал для $y_{t+1}$ и $y_{t+2}$ через $\ell_t$, $b_t$, $y_t$ и $u_t$. 
\begin{sol}
\end{sol}
\end{problem}

\begin{problem}
Найдите $\E(y_t)$, $\Var(y_t)$, $\Cov(y_t, y_{t+1})$ для $ETS(AAN)$ модели с заданными $\ell_0$, $b_0$, $\alpha$, $\beta$ и $\sigma^2$.
\begin{sol}
\end{sol}
\end{problem}


\begin{problem}
Полугодовой $y_t$ моделируется с помощью $ETS(AAA)$ процесса:
    
\[
\begin{cases}
    u_t \sim \cN(0; 4) \\
    s_t = s_{t-2} + 0.1 u_t \\
    b_t = b_{t-1} + 0.2 u_t \\
    \ell_t = \ell_{t-1} + b_{t-1} + 0.3 u_t \\
    y_t = \ell_{t-1} + b_{t-1} + s_{t-2} + u_t \\
\end{cases}    
\]

\begin{enumerate}
    \item Известно, что $s_{100} = 2$, $s_{99} = -1.9$, $b_{100} = 0.5$, $\ell_{100} = 4$. Найдите 95\% предиктивный интервал для $y_{102}$. 
    \item В этой задаче все параметры известны. Сколько параметров оценивается в реальной задаче прогнозирования с помощью $ETS(AAA)$ модели?
\end{enumerate}
\begin{sol}

  Запишем $y_{102}$:

  \[
  y_{102} = l_{101} + b_{101} + s_{100} + u_{102} = l_{100} + b_{100} + 0.3 u_{101} + b_{100} + 0.2 u_{101} + s_{100} + u_{102}
  \]
  
  Найдём условное математическое ожидание $y_{102}$ при известной информации $\cF_{100}$:
  
  \[
  \E(y_{102}\mid \cF_{100}) = \E(l_{100} + b_{100} + 0.3 u_{101} + b_{100} + 0.2 u_{101} + s_{100} + u_{102}\mid \cF_{100}) = l_{100} + 2 b_{100} + s_{100} = 4 + 2 \cdot 0.5 + 2 = 7
  \]
  
  Аналогично, найдём условную дисперсию $y_{102}$ при известной информации $\cF_{100}$:
  
  \begin{align*}  
  \Var(y_{102}\mid \cF_{100}) = \Var(l_{100} + b_{100} + 0.3 u_{101} + b_{100} + 0.2 u_{101} + s_{100} + u_{102}\mid \cF_{100}) = \Var((0.3+0.2)u_{101} + u_{102}\mid \cF_{100}) =\\
   = 0.25 \Var(u_{101}) + \Var(u_{102}) = 1 + 4 = 5
\end{align*}
  
  В результате, $(y_{102} \mid \cF_{100}) \sim \cN(7, 5)$, а значит 95\% доверительный интервал имеет вид:
  \[
  \left[7 - 1.96 \cdot \sqrt{5}, 7 + 1.96 \cdot \sqrt{5} \right]
  \]
  
  Ответ: 7 свободных параметров для ETS(AAA) с полугодовой сезонностью:
  \[
  s_0, \quad b_0,  \quad l_0, \quad \alpha, \quad \beta, \quad \gamma, \quad \sigma^2
  \]
  
  Примечание: 
  \[
  s_0 + s_{-1} = 0 \quad \quad \quad  s_{-1} = - s_{0}
  \]

\end{sol}
\end{problem}

\begin{problem}
Вспомним $ETS(AAN)$ модель, кстати, вот и уравнения:

\[
\begin{cases}
y_t = \ell_{t-1} + b_{t-1} + u_t \\
\ell_t = \ell_{t-1} + b_{t-1} + \alpha u_t \\
b_t = b_{t-1} + \beta u_t \\
u_t \sim \cN(0;\sigma^2) \\
% s_t = s_{t-12} + \gamma \varepsilon_t \\
\end{cases}
\]

\begin{enumerate}
	\item 
	Докажите, что ни при каких $\ell_0$ и $b_0$ этот процесс не будет стационарным. 
	Или опровергните и приведите пример, при каких будет. 
	
	Константы $\alpha$, $\beta$ лежат в интервале $(0;1)$.
	
	\item При $l_{100} = 20$, $b_{100} = 2$, $\alpha=0.2$, $\beta=0.3$, $\sigma^2 = 16$ постройте
	интервальный прогноз на один и два шага вперёд. 
\end{enumerate}
\begin{sol}
\end{sol}
\end{problem}





\chapter{TBATS}

Оригинальная статья, \cite{de2011forecasting}.

Относим к ETS как модель с одной ошибкой в разных уравнениях. 

\begin{problem}
  Найдите предел
  \[
    \lim_{w \to 0} \frac{y^w - 1}{w}
  \]
\begin{sol}
  $\ln y$
\end{sol}
\end{problem}


